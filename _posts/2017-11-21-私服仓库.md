---
layout: post
title: 私服仓库
date: 2017-11-21
description: "私服仓库，用于项目开发、管理以及发布"
tags: [Maven，gradle，私服]
---


## 定义
Maven仓库就是放置第三方JAR文件（WAR，ZIP，POM等等）的地方，所有Maven项目可以从同一个Maven仓库中获取自己所需要的依赖JAR。此外，由于Maven仓库中所有的JAR都有其自己的坐标，该坐标告诉Maven它的组ID，构件ID，版本，打包方式等等，因此Maven项目可以方便的进行依赖版本管理。
## 仓库分类
![5 n a7uxiedn5 avie 7pr](https://user-images.githubusercontent.com/14925803/30572854-d1fe29b2-9d22-11e7-81f3-b0baf1844935.png)
### 本地仓库
在运行Maven的时，Maven所需要的依赖构件都是直接从本地仓库获取的，如果本地仓库有依赖构建，直接使用；如果本地仓库没有，它会首先尝试从远程仓库下载构件至本地仓库，然后再使用本地仓库的构件。  
本地仓库缺省地址在${user.home}/.m2/repository目录下,(例如:C:\Documents and Settings\Administrator\.m2\repository)；自定义本地仓库位置： 配置进入maven/conf目录 编辑settings.xml文件 修改localRepository节点
### 中央仓库 
是一个默认的远程仓库,  当Maven在本地仓库找不到需要的jar文件时，它会查找远程仓库，而一个原始的Maven安装就自带了一个远程仓库——Maven中央仓库。 这个Maven中央仓库是在apache-maven3\lib\maven-model-builder-3.0.4.jar中定义,
 ### 私服
是一种特殊的远程仓库  为了节省宽带资源和时间 应该在局域网内架设一个私有的仓库服务器，私服代理广域网上的远程仓库， 供局域网内的Maven用户使用，当Maven需要下载构建的时候，先给私服仓库发出请求， 如果私服上不存在构建，则从外部的远程仓库下载，缓存到私服仓库中，再为maven的下载请求提供服务。  
  
## maven的settings.xml文档
![p lz3c4 bj8pne9182mt 3](https://user-images.githubusercontent.com/14925803/30573519-ed012f62-9d26-11e7-9eac-0feac99c31cd.png)  

## 私服搭建
### 安装服务器
1、下载
 我们可以在nexus的官网上找到它的相关介绍，下载地址是：http://nexus.sonatype.org/downloads/，在这里可以找到最新的版本，如果需要以前的版本，在官网上应该也可以找到下载地址。关于Nexus的详细使用方法可以参照：Repository Management with Nexus.然后将下载的文件上传到服务器上，利用XShell上传、下载文件（使用sz与rz命令）。  
 借助XShell，使用linux命令sz可以很方便的将服务器上的文件下载到本地，使用rz命令则是把本地文件上传到服务器。  
 sz中的s意为send（发送），告诉客户端，我（服务器）要发送文件 send to cilent，就等同于客户端在下载。  
 rz中的r意为received（接收），告诉客户端，我（服务器）要接收文件 received by cilent，就等同于客户端在上传。  
 不论是send还是received，动作都是在服务器上发起的。  
#### sz用法：
下载一个文件    
sz filename 
下载多个文件  
sz filename1 filename2  
下载dir目录下的所有文件，不包含dir下的文件夹  
sz dir/*  
#### rz用法：  
输入rz回车后，会出现文件选择对话框，选择需要上传文件，一次可以指定多个文件，上传到服务器的路径为当前执行rz命令的目录。

### 安装
解压下载的文件：  
tar xzvf nexus-oss-webapp-1.8.0-bundle.tar.gz  
解压后会在同级目录中，出现两个文件夹：nexus-oss-webapp-1.8.0和sonatype-work，前者包含了nexus的运行环境和应用程序，后者包含了你自己的配置和数据  ### 启动nexus  
在上面的提到，nexus的运行环境在nexus-oss-webapp-1.8.0目录，下面就进入这个目录启动：  
cd nexus-oss-webapp-1.8.0/bin/jsw/linux-x86-64/  
在这个目录下包含了一个文件夹和三个文件：lib、nexus、platform和wrapper，其中nexus就是启动命令。  
./nexus  
执行上面的命令，可以得到nexus命令的用法提示：start 命令启动，stop命令停止。下面启动nexus：  
./nexus start  
Starting Nexus OSS...  
Started Nexus OSS  
从控制台输出可以看到Nexus已经启动成功，我们可以通过log文件查看更详细的信息：  
cd ~/nexus-oss-webapp-1.8.0/log  
tail -f wrapper.log  
在log中可以看到nexus默认监听的端口是8081。
![x _7mchiyokie6ie3hojd](https://user-images.githubusercontent.com/14925803/30573305-a7ba9110-9d25-11e7-82d2-62ffff30542c.png)
利用默认账号密码登录
![v azx 8fdo2eemhwcg2 ty](https://user-images.githubusercontent.com/14925803/30573350-e78e2252-9d25-11e7-9365-bf4c5acc963a.png)
maven-central：maven中央库，默认从https://repo1.maven.org/maven2/拉取jar   
maven-releases：私库发行版jar   
maven-snapshots：私库快照（调试版本）jar   
maven-public：仓库分组，把上面三个仓库组合在一起对外提供服务，在本地maven基础配置settings.xml中使用。
## 构建部署至远程仓库
mvn install 会将项目生成的构件安装到本地Maven仓库，mvn deploy 用来将项目生成的构件分发到远程Maven仓库。  
本地Maven仓库的构件只能供当前用户使用，在分发到远程Maven仓库之后，所有能访问该仓库的用户都能使用你的构件。
Maven区别对待release版本的构件和snapshot版本的构件，snapshot为开发过程中的版本，实时，但不稳定，release版本则比较稳定。  
Maven会根据你项目的版本来判断将构件分发到哪个仓库。
一般来说，分发构件到远程仓库需要认证，如果你没有配置任何认证信息，你往往会得到401错误。这个时候，如下在settings.xml中配置认证信息
### maven配置文件发布
配置POM的distributionManagement来指定Maven的部署位置
![8 h 5 8ns fne 5d z y2l](https://user-images.githubusercontent.com/14925803/30573407-4cd70066-9d26-11e7-8388-704dcc2ae49a.png)  
### gradle配置文件发布  
    publishing {
    publications {
        maven(MavenPublication){
            groupId 'com.cmcc'
            artifactId 'jartest'
            version '1.0.0'
            from components.java
        }
    }
    repositories {
        maven {
            if (project.version.endsWith('-SNAPSHOT')) {
            url = 'http://.../repository/maven-snapshots/'
                   
        } else {
            url = 'http://.../repository/maven-releases/'
        }
            credentials {
                
            }
        }
    }

